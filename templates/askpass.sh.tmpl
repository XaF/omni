#!/usr/bin/env sh
#
# This script is generated by omni to allow for a better handling
# of password requests during omni operations. It is not meant to be
# run directly by the user.

{% if INTERACTIVE -%}
{%   if TOOL == "ssh" -%}
PROMPT="${*:-"{{ TOOL }} password:"}"
{%     set prompt = "$PROMPT" -%}
{%   else -%}
{%     set prompt = "{{ TOOL }} password:" -%}
{%   endif -%}
{{ OMNI_BIN }} --askpass "{{ prompt }}" "{{ SOCKET_PATH }}"
exit $?
{% else -%}
{%   if TOOL == "ssh" -%}
PROMPT="${*:-"Omni needs your {{ TOOL }} password to continue"}"
{%     set prompt = "$PROMPT" -%}
{%   else -%}
{%     set prompt = "Omni needs your {{ TOOL }} password to continue" -%}
{%   endif -%}
if command -v osascript >/dev/null; then
    osascript='display dialog "'"{{ prompt }}"'" '
    osascript="$osascript"'with title "Omni Password Request ({{ TOOL }})" '
    osascript="$osascript"'buttons {"Cancel", "Ok"} '
    osascript="$osascript"'default button "Ok" '
    osascript="$osascript"'default answer "" '
    osascript="$osascript"'with icon file "System:Library:CoreServices:CoreTypes.bundle:Contents:Resources:LockedIcon.icns" '
    osascript="$osascript"'with hidden answer '
    osascript="$osascript"'giving up after 60'
    osascript="text returned of ($osascript)"
    osascript -e "$osascript"
    exit $?
fi

exit 1
{%- endif %}
